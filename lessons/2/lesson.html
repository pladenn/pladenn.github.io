

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>

    <body>
        <a href="/lessons">Уроки</a>

        <h2>Урок 2</h2>

        <h3>Новые слова:</h3>
        <div id="new_words"></div>
        <br>

        <h3>Повторение:</h3>
        <div id="review_words"></div>
        <br>

        <h3>Примеры:</h3>
        <div id="examples"></div>
        <br>

        <a href="/lessons/2/task">Задание</a>

        <script>

            function createElement(element) {
                return document.createElement(element);
            }

            function createElementWithText(element, text) {
                let elem = createElement(element);
                elem.innerText = text;
                return elem;
            }

            function createDiv() {
                return createElement("div");
            }

            function createDivWithClass(className) {
                var div = createDiv();
                div.className = className;
                return div;
            }

            const BLACK = "black";
            const THIN_BORDER = "1px";
            const THICK_BORDER = "3px";

            class ContentItem {

                constructor(sourceContentItem, openDropDownContent, fullContent) {
                    this.openDropDownContent = openDropDownContent;

                    this.fullContent = fullContent;
                    this.sourceContentItem = sourceContentItem;
                    this.open = false;
                    this.highlighted = false;

                    this.mouseover = false;
                    this.specific = sourceContentItem.specific;
                    this.sourceWord = sourceContentItem.sourceWord;

                    this.compose = this.createCompose();
                    this.ruWordComponent = this.createRuWordComponent();
                    this.compose.appendChild(this.ruWordComponent);
                    let component = this;
                    this.ruWordComponent.onmouseover = function () {
                        component.onmouseover()
                    };

                    this.ruWordComponent.onmouseout = function () {
                        component.onmouseout()
                    };
                    if (!this.sourceContentItem.specific) {
                        this.ltWordComponentDropDownContent = this.createDropDownContent();
                        this.compose.appendChild(this.ltWordComponentDropDownContent);
                        this.addTranslations();
                        let component = this;
                        component.compose.onclick = function () {
                            component.openCloseDropDownContent();
                        }
                    }

                }

                createCompose() {
                    let element = createDiv();
                    element.style.display = "inline";
                    return element;
                }

                setView() {
                    let color = BLACK;
                    let borderPresent = false;
                    let borderWidth = THIN_BORDER;

                    if (this.specific) {
                        return;
                    }

                    if (this.open || this.mouseover) {
                        borderPresent = true;
                    }

                    if (this.open) {
                        borderWidth = THICK_BORDER;
                    }

                    this.setStateStyle(color, borderPresent, borderWidth);
                }

                setStateStyle(color, borderPresent, borderWidth) {
                    let ruWordComponent = this.ruWordComponent;
                    let dropDownContent = this.ltWordComponentDropDownContent;

                    ruWordComponent.style.borderStyle = "solid";

                    if (borderPresent) {
                        ruWordComponent.style.borderWidth = borderWidth;
                    } else {
                        ruWordComponent.style.border = "none";
                    }

                    ruWordComponent.style.borderColor = color;

                    if (dropDownContent != null) {
                        dropDownContent.style.borderColor = color;
                    }
                }

                openCloseDropDownContent() {
                    let element = this.ltWordComponentDropDownContent;
                    let current = element.style.display;

                    if (current === "block") {
                        this.closeDropDownContent();
                    } else {
                        element.style.display = "block";
                        element.style.top = this.ruWordComponent.getBoundingClientRect().bottom + 'px';
                        element.style.left = this.ruWordComponent.getBoundingClientRect().left + 'px';
                        this.open = true;
                        this.openDropDownContent(this);
                        this.setView();
                    }
                }

                closeDropDownContent() {
                    let element = this.ltWordComponentDropDownContent;
                    element.style.display = "none";
                    this.open = false;
                    this.setView();
                }

                addTranslations() {
                    this.ltWordComponentDropDownContent.appendChild(createElementWithText("div", this.sourceContentItem.translationText));
                    this.ltWordComponentDropDownContent.appendChild(createElementWithText("h4", "Доступные переводы:"))
                    let translations = this.sourceContentItem.word.translations;
                    for (let translation of translations) {
                        this.ltWordComponentDropDownContent.appendChild(createElementWithText("div", translation.word));
                    }
                }

                createDropDownContent() {
                    let element = createDiv();
                    element.style.borderWidth = THICK_BORDER;
                    element.style.borderColor = BLACK;
                    element.style.borderStyle = "solid";
                    element.style.display = "none";
                    element.style.width = "fit-content";
                    element.style.position = "absolute";
                    element.style.backgroundColor = "white";


                    return element;
                }

                createRuWordComponent() {
                    let element = createDiv();
                    element.style.display = "inline";
                    element.style.cursor = "pointer";
                    element.innerText = this.sourceContentItem.sourceWord.replace("{", "").replace("}","");
                    if (this.fullContent && !this.specific) {
                        element.innerText = element.innerText + " - " + this.sourceContentItem.translationText;
                    }
                    return element;
                }

                onmouseover() {
                    this.mouseover = true;
                    this.setView();
                }

                onmouseout() {
                    this.mouseover = false;
                    this.setView();
                };
            }

            class ContentComponent {
                constructor(contentArea, fullContent) {``
                    this.contentArea = contentArea;
                    this.currentOpenContentItem = null;
                    this.allContentItems = [];
                    this.fullContent = fullContent;
                }

                addContentItem(contentItem) {
                    this.contentArea.appendChild(contentItem.compose);
                    this.allContentItems.push(contentItem);
                }

                openLtRuComponent(ltRuComponent) {
                    if (this.currentOpenContentItem === null) {
                        this.currentOpenContentItem = ltRuComponent;
                        return;
                    }

                    if (this.currentOpenContentItem !== ltRuComponent) {
                        this.currentOpenContentItem.closeDropDownContent();
                        this.currentOpenContentItem = ltRuComponent;
                    }
                }

            }

            function fillContent(data, contentArea, fullContent) {
                contentArea.innerHTML = "";
                let contentComponent = new ContentComponent(contentArea, fullContent);

                let openLtRuComponent = function (ltRuComponent) {
                    contentComponent.openLtRuComponent(ltRuComponent);
                }

                for (let sourceContentItem of data) {
                    contentComponent.addContentItem(new ContentItem(sourceContentItem, openLtRuComponent, fullContent));
                }
            }

            let newWords = [{"sourceWord":"esu","specific":false,"order":0,"translationId":"b48230f8-5128-4fc1-8e1c-b7bee340893d","translationText":"я есть/являюсь","word":{"word":"esu","translations":[{"word":"я есть/являюсь","translationId":"b48230f8-5128-4fc1-8e1c-b7bee340893d"}]},"placeholder":false}];
            let reviewWords = [];
            let examples = [];

            fillContent(newWords, document.getElementById("new_words"), true);
            fillContent(reviewWords, document.getElementById("review_words"), true);
            fillContent(examples, document.getElementById("examples"), false);
        </script>
    </body>
</html>
